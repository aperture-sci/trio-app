name: Build Trio ctrlr

on:
  push:
    branches:
      - main
    paths:
      - ctrlr/**
  workflow_dispatch: # This event enables manual triggering
  
jobs:
  build:
    runs-on:  ubuntu-latest
    # outputs:
    #   sha_short: ${{ steps.vars.outputs.sha_short }}

    steps:
    # - uses: actions/checkout@v2
    # - name: Create SHORT_SHA
    #   id: vars
    #   run: echo "SHORT_SHA=$(git rev-parse --short HEAD)" >> $GITHUB_ENV

    - name: Login to Docker Hub
      uses: docker/login-action@v3
      with:
        username: aperturesci
        password: ${{ secrets.DOCKERHUB_PAT }}

    # - name: Build image
    #   run: |
    #     cd ctrlr
    #     docker build -t aperturesci/ctrlr:${{ github.ref_name }} .

    - name: Building the Docker image
      uses: docker/build-push-action@v6.18.0
      with:
        push: true
        context: "{{defaultContext}}:ctrlr"
        tags: aperturesci/ctrlr:${{ github.ref_name }}