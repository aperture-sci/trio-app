name: Build Trio ctrlr

on:
  push:
    branches:
      - main
    paths:
      - ctrlr/**
  workflow_dispatch: # This event enables manual triggering
  
jobs:
  build:
    runs-on:  ubuntu-latest
    outputs:
      sha_short: ${{ steps.vars.outputs.sha_short }}

    steps:
    - uses: actions/checkout@v2
    - name: Create SHORT_SHA
      id: vars
      run: echo "SHORT_SHA=$(git rev-parse --short HEAD)" >> $GITHUB_ENV

    - name: Login to Docker Hub
      uses: docker/login-action@v3
      with:
        username: aperturesci
        password: ${{ secrets.DOCKERHUB_PAT }}

    - name: Access Source directory
      run: cd ctrlr

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    - name: Building the Docker image
      uses: docker/build-push-action@v6.18.0
      with:
        push: true
        tags: aperturesci/ctrlr:${{ github.ref_name }},aperturesci/ctrlr:${{ github.ref_name }}-${{ env.SHORT_SHA }}